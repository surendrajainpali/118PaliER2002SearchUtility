<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>ER2002 Search Utility - AC 118 Pali</title>
<style>
  body {
    font-family: sans-serif;
    padding: 20px;
    max-width: 800px;
    margin: auto;
    background-color: #ffffff;
    color: #000000;
  }

  h2 {
    background-color: #ffffff;
    color: #0077cc;
    padding: 12px;
    border-radius: 6px;
    text-align: center;
    border: 1px solid #ccc;
  }

  input {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    margin-bottom: 10px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
    margin-top: 10px;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: left;
  }

  th {
    background-color: #f2f2f2;
  }

  tr:nth-child(even) {
    background-color: #fafafa;
  }

  #status {
    font-size: 14px;
    margin-bottom: 10px;
    font-weight: bold;
  }

  #status.loading {
    color: #cc0000; /* üî¥ Red for "‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à..." */
  }

  #status.loaded {
    color: #006400; /* üü¢ Dark green for "‡§ï‡•Å‡§≤ ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è" */
  }

  #pagination {
    margin-top: 20px;
    text-align: center;
  }

  #pagination button {
    padding: 6px 12px;
    margin: 0 5px;
    font-size: 14px;
  }

  @media (prefers-color-scheme: dark) {
    body {
      background-color: #ffffff !important;
      color: #000000 !important;
    }
  }
</style>

</head>
<body>

<h2>üîç ‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ, ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ ‡§Ø‡§æ EPIC ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç </h2>
<p id="status">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
<input type="text" id="searchBox" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç..." disabled />

<table id="resultsTable">
  <thead>
    <tr>
      <th>Old AC No.</th>
      <th>Part No.</th>
      <th>S. NO.</th>
      <th>H. NO.</th>
      <th>Name</th>
      <th>Relative Name</th>
      <th>Age</th>
      <th>EPIC</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="pagination"></div>

<script>
let data = [];
let filtered = [];
let currentPage = 1;
const resultsPerPage = 20;

const chunkPaths = Array.from({ length: 9 }, (_, i) => `chunks/data${i + 1}.json`);

Promise.allSettled(
  chunkPaths.map(path =>
    fetch(path)
      .then(r => r.ok ? r.json() : [])
      .catch(() => [])
  )
).then(results => {
  data = results
    .filter(result => result.status === 'fulfilled')
    .flatMap(result => result.value);
  document.getElementById('searchBox').disabled = false;
  document.getElementById('status').textContent = `‚úÖ ‡§ï‡•Å‡§≤ ${data.length} ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`;
  console.log(`‚úÖ Loaded ${data.length} records`);
}).catch(err => {
  console.error('‚ùå Failed to load data:', err);
  document.getElementById('searchBox').disabled = false;
  document.getElementById('status').textContent = '‚ö†Ô∏è ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à';
});

document.getElementById('searchBox').addEventListener('input', () => {
  clearTimeout(window.debounceTimer);
  window.debounceTimer = setTimeout(() => {
    currentPage = 1;
    filterData();
    renderPage();
  }, 300);
});

function normalize(str) {
  return str ? str.replace(/\s+/g, ' ').trim().toLowerCase() : '';
}

function filterData() {
  const query = normalize(document.getElementById('searchBox').value);
  filtered = data.filter(row =>
    normalize(row['Name']).includes(query) ||
    normalize(row['Relative Name']).includes(query) ||
    normalize(row['EPIC']).includes(query)
  );
}



function renderPage() {
  const tableBody = document.querySelector('#resultsTable tbody');
  tableBody.innerHTML = '';

  const start = (currentPage - 1) * resultsPerPage;
  const end = start + resultsPerPage;
  const pageData = filtered.slice(start, end);

  pageData.forEach(row => {
    const tr = document.createElement('tr');
    ['Old AC No.', 'Part No.', 'S. NO.', 'H. NO.', 'Name', 'Relative Name', 'Age', 'EPIC'].forEach(key => {
      const td = document.createElement('td');
      td.textContent = row[key] || '';
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });

  updatePaginationControls();
}

function updatePaginationControls() {
  const controls = document.getElementById('pagination');
  controls.innerHTML = '';

  if (filtered.length <= resultsPerPage) return;

  const totalPages = Math.ceil(filtered.length / resultsPerPage);

  const prevBtn = document.createElement('button');
  prevBtn.textContent = '‚¨ÖÔ∏è ‡§™‡§ø‡§õ‡§≤‡§æ';
  prevBtn.disabled = currentPage === 1;
  prevBtn.onclick = () => {
    currentPage--;
    renderPage();
  };

  const nextBtn = document.createElement('button');
  nextBtn.textContent = '‚û°Ô∏è ‡§Ö‡§ó‡§≤‡§æ';
  nextBtn.disabled = currentPage === totalPages;
  nextBtn.onclick = () => {
    currentPage++;
    renderPage();
  };

  controls.appendChild(prevBtn);
  controls.appendChild(document.createTextNode(` ‡§™‡•á‡§ú ${currentPage} / ${totalPages} `));
  controls.appendChild(nextBtn);
}
const statusEl = document.getElementById('status');

// While loading
statusEl.textContent = '‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...';
statusEl.className = 'loading';

// After loading
statusEl.textContent = `‚úÖ ‡§ï‡•Å‡§≤ ${data.length} ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`;
statusEl.className = 'loaded';

</script>

</body>
</html>















