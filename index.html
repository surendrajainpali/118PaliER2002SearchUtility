<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>ER2002 Search Utility</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    input { width: 100%; padding: 10px; font-size: 16px; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background-color: #f2f2f2; }
    tr:nth-child(even) { background-color: #fafafa; }
    #status { font-size: 14px; color: #555; margin-bottom: 10px; }
  </style>
</head>
<body>

<h2>üîç ‡§ñ‡•ã‡§ú‡•á‡§Ç ‡§®‡§æ‡§Æ, ‡§∏‡§Ç‡§¨‡§Ç‡§ß‡•Ä ‡§ï‡§æ ‡§®‡§æ‡§Æ, ‡§Ø‡§æ EPIC ‡§¶‡•ç‡§µ‡§æ‡§∞‡§æ</h2>
<p id="status">‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à...</p>
<input type="text" id="searchBox" placeholder="‡§Ø‡§π‡§æ‡§Å ‡§ü‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç..." disabled />

<table id="resultsTable">
  <thead>
    <tr>
      <th>Old AC No.</th>
      <th>Part No.</th>
      <th>S. NO.</th>
      <th>H. NO.</th>
      <th>Name</th>
      <th>Relative Name</th>
      <th>Age</th>
      <th>EPIC</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let data = [];
let debounceTimer;

const chunkPaths = Array.from({ length: 9 }, (_, i) => `chunks/data${i + 1}.json`);

Promise.allSettled(
  chunkPaths.map(path =>
    fetch(path)
      .then(r => r.ok ? r.json() : [])
      .catch(() => [])
  )
).then(results => {
  data = results
    .filter(result => result.status === 'fulfilled')
    .flatMap(result => result.value);
  document.getElementById('searchBox').disabled = false;
  document.getElementById('status').textContent = `‚úÖ ‡§ï‡•Å‡§≤ ${data.length} ‡§∞‡§ø‡§ï‡•â‡§∞‡•ç‡§° ‡§≤‡•ã‡§° ‡§π‡•Å‡§è`;
  console.log(`‚úÖ Loaded ${data.length} records`);
}).catch(err => {
  console.error('‚ùå Failed to load data:', err);
  document.getElementById('searchBox').disabled = false;
  document.getElementById('status').textContent = '‚ö†Ô∏è ‡§°‡•á‡§ü‡§æ ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ ‡§Ü‡§à';
});

// Debounced input listener
document.getElementById('searchBox').addEventListener('input', () => {
  clearTimeout(debounceTimer);
  debounceTimer = setTimeout(searchData, 300);
});

function searchData() {
  const query = document.getElementById('searchBox').value.toLowerCase();
  const tableBody = document.querySelector('#resultsTable tbody');
  tableBody.innerHTML = '';

  if (!query.trim()) return;

  const filtered = data.filter(row =>
    (row['Name'] && row['Name'].toLowerCase().includes(query)) ||
    (row['Relative Name'] && row['Relative Name'].toLowerCase().includes(query)) ||
    (row['EPIC'] && row['EPIC'].toLowerCase().includes(query))
  );

  filtered.slice(0, 100).forEach(row => {
    const tr = document.createElement('tr');
    ['Old AC No.', 'Part No.', 'S. NO.', 'H. NO.', 'Name', 'Relative Name', 'Age', 'EPIC'].forEach(key => {
      const td = document.createElement('td');
      td.textContent = row[key] || '';
      tr.appendChild(td);
    });
    tableBody.appendChild(tr);
  });
}
</script>

</body>
</html>
